import qs from "qs"

export default class {
  static get(path, data = null) {
    if (data) {
      var pathParamsString = qs.stringify(data, {"arrayFormat": "brackets"})
      path += `?${pathParamsString}`
    }

    return new Promise((resolve, reject) => {
      var xhr = new XMLHttpRequest()
      xhr.open("GET", path)
      xhr.setRequestHeader("Content-Type", "application/json")
      xhr.setRequestHeader("X-CSRF-Token", this.token())
      xhr.onload = () => {
        if (xhr.status == 200) {
          var response = JSON.parse(xhr.responseText)
          resolve(response)
        } else {
          reject(xhr.responseText)
        }
      }
      xhr.send()
    })
  }

  static post(path, data = {}) {
    return new Promise((resolve, reject) => {
      var xhr = new XMLHttpRequest()
      xhr.open("POST", path)
      xhr.setRequestHeader("Content-Type", "application/json")
      xhr.setRequestHeader("X-CSRF-Token", this.token())
      xhr.onload = () => {
        if (xhr.status == 200) {
          var response = JSON.parse(xhr.responseText)
          resolve(response)
        } else {
          reject(xhr.responseText)
        }
      }
      xhr.send(JSON.stringify(data))
    })
  }

  static token() {
    var tokenElement = document.querySelector("meta[name='csrf-token']")

    if (tokenElement)
      return tokenElement.getAttribute("content")
  }
}
